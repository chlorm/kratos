#!/bin/sh
cd "$(readlink -f $(dirname $(readlink -f $0))/../)"
. lib/integrity

# Required programs
require_all

# Check for valid arguments
[ "$#" -ne "1" ] && {
  echo "$0 message" >&2
  exit 1
}

# Pull the latest changes

# Commit Current Changes
date -u +%s > .date
git add .date
git commit -m "$1" >/dev/null 2>&1

# Sign and Commit Signature
hash_commit "HEAD" > .hash
rm -f .sig
gpg -bo .sig .hash
git add .hash .sig
git commit -m "Signing Commit" >/dev/null 2>&1
git push origin master >/dev/null 2>&1
[ "$?" -ne "0" ] && {
  echo "Failed To Push Commit!" >&2
  exit 1
}

exit 0
